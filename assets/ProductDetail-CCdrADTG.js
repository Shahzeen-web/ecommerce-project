import{q as h,g as c,o as y,j as e,v as E,w as A,H as L}from"./index-WHZf0VKo.js";const I=void 0,k=async a=>a?(await h.get(`${I}/api/products/autocomplete`,{params:{query:a}})).data.map(o=>o.name):[],D=()=>{const[a,l]=c.useState(""),[o,t]=c.useState([]),m=y();c.useEffect(()=>{const r=setTimeout(()=>{a.trim()?k(a).then(t):t([])},300);return()=>clearTimeout(r)},[a]);const i=r=>{r.preventDefault(),a.trim()&&m(`/products?search=${a}`)};return e.jsxs("div",{className:"relative w-full max-w-md mx-auto",children:[e.jsx("form",{onSubmit:i,children:e.jsx("input",{type:"text",className:"w-full border px-3 py-2 rounded",placeholder:"Search products...",value:a,onChange:r=>l(r.target.value)})}),o.length>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded mt-1 max-h-48 overflow-y-auto",children:o.map((r,x)=>e.jsx("li",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{l(r),t([]),m(`/products?search=${r}`)},children:r},x))})]})},g="https://ecommerce-project-production-28e7.up.railway.app",W=()=>{var j,f,N,v;const{id:a}=E(),l=y(),o=A(s=>s.addToCart),[t,m]=c.useState(null),[i,r]=c.useState([]),[x,b]=c.useState(!0),[p,w]=c.useState("");if(c.useEffect(()=>{(async()=>{try{const n=await h.get(`${g}/api/products/${a}`),d=await h.get(`${g}/api/reviews/${a}`),u=Array.isArray(d.data)?d.data:[],U=u.reduce((C,P)=>C+P.rating,0),$=u.length?U/u.length:0;m({...n.data,avgRating:$}),r(u)}catch(n){console.error("Error fetching product or reviews:",n),w("Failed to load product details.")}finally{b(!1)}})()},[a]),x)return e.jsx("div",{className:"p-8",children:"Loading..."});if(p)return e.jsx("div",{className:"p-8 text-red-600",children:p});if(!t)return e.jsx("div",{className:"p-8",children:"Product not found"});const S=(j=t.imageUrl)!=null&&j.startsWith("http")?t.imageUrl:`${g}${(f=t.imageUrl)!=null&&f.startsWith("/")?t.imageUrl:`/${t.imageUrl}`}`,R=(v=(N=t.category)==null?void 0:N.name)==null?void 0:v.toLowerCase().includes("book");return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(L,{children:[e.jsxs("title",{children:[t.name," | E-Commerce Store"]}),e.jsx("meta",{name:"description",content:t.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("img",{src:S,alt:t.name,loading:"lazy",width:400,height:R?400:300,className:"w-full rounded-lg object-cover",onError:s=>{s.target.onerror=null,s.target.src="https://dummyimage.com/400x300/cccccc/000000&text=No+Image"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:t.description}),e.jsxs("p",{className:"text-xl font-semibold mt-4",children:["PKR ",t.price]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs("span",{className:"text-yellow-500",children:["★".repeat(Math.round(t.avgRating)),"☆".repeat(5-Math.round(t.avgRating))]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",i.length," reviews)"]})]}),e.jsx("button",{onClick:()=>{o(t),l("/cart")},className:"mt-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add to Cart"})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Customer Reviews"}),i.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviews yet."}):i.map(s=>{var n;return e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("strong",{children:((n=s.user)==null?void 0:n.name)||"User"}),e.jsxs("span",{className:"text-yellow-500",children:["★".repeat(s.rating),"☆".repeat(5-s.rating)]})]}),e.jsx("p",{className:"text-gray-800",children:s.comment}),s.imageUrl&&e.jsx("img",{src:s.imageUrl.startsWith("http")?s.imageUrl:`${g}${s.imageUrl.startsWith("/")?s.imageUrl:`/${s.imageUrl}`}`,alt:"review",loading:"lazy",className:"mt-2 w-32 rounded-md object-cover",onError:d=>{d.target.onerror=null,d.target.src="https://dummyimage.com/100x100/cccccc/000000&text=No+Image"}}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(s.createdAt).toLocaleDateString()})]},s.id)}),e.jsx(D,{productId:t.id})]})]})};export{W as default};
