import{g as l,j as e,w as A,o as E,v as L,q as C,H as I}from"./index-ChZqENbQ.js";const k=({productId:m,onReviewSubmit:j})=>{const[o,a]=l.useState(0),[c,i]=l.useState(""),[d,h]=l.useState(null),[g,u]=l.useState(null);l.useEffect(()=>{if(d){const s=URL.createObjectURL(d);return u(s),()=>URL.revokeObjectURL(s)}else u(null)},[d]);const b=s=>{h(s.target.files[0])},v=s=>{if(s.preventDefault(),!o||!c.trim()){alert("Please provide a rating and a comment.");return}const N={productId:m,rating:o,comment:c,image:g,createdAt:new Date().toISOString()};j(N),a(0),i(""),h(null)};return e.jsxs("form",{onSubmit:v,className:"border p-4 rounded-lg shadow-md mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Write a Review"}),e.jsx("div",{className:"flex gap-1 mb-3",children:[1,2,3,4,5].map(s=>e.jsx("span",{className:`cursor-pointer text-2xl ${s<=o?"text-yellow-500":"text-gray-400"}`,onClick:()=>a(s),role:"button","aria-label":`Rate ${s} star`,children:"★"},s))}),e.jsx("label",{className:"block mb-1 font-medium",children:"Your Comment:"}),e.jsx("textarea",{value:c,onChange:s=>i(s.target.value),className:"w-full border rounded p-2 mb-3",rows:"3",placeholder:"Write your review..."}),e.jsx("label",{className:"block mb-1 font-medium",children:"Upload an Image:"}),e.jsx("input",{type:"file",accept:"image/*",onChange:b,className:"mb-3"}),g&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:g,alt:"Preview",className:"w-24 h-24 object-cover rounded"})}),e.jsx("button",{type:"submit",disabled:!o||!c.trim(),className:`px-4 py-2 rounded text-white ${!o||!c.trim()?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:"Submit Review"})]})},p="https://ecommerce-project-production-28e7.up.railway.app",D=()=>{var R,y,U,S;const{id:m}=A(),j=E(),o=L(t=>t.addToCart),[a,c]=l.useState(null),[i,d]=l.useState([]),[h,g]=l.useState(!0),[u,b]=l.useState("");l.useEffect(()=>{v()},[m]);const v=async()=>{try{const t=await C.get(`${p}/api/products/${m}`),r=await C.get(`${p}/api/reviews/${m}`),n=Array.isArray(r.data)?r.data:[],w=n.reduce((f,P)=>f+P.rating,0),x=n.length?w/n.length:0;c({...t.data,avgRating:x}),d(n)}catch(t){console.error("Error fetching product or reviews:",t),b("Failed to load product details.")}finally{g(!1)}},s=t=>{const r=[t,...i];d(r);const n=r.reduce((x,f)=>x+f.rating,0),w=r.length?n/r.length:0;c(x=>({...x,avgRating:w}))};if(h)return e.jsx("div",{className:"p-8",children:"Loading..."});if(u)return e.jsx("div",{className:"p-8 text-red-600",children:u});if(!a)return e.jsx("div",{className:"p-8",children:"Product not found"});const N=(R=a.imageUrl)!=null&&R.startsWith("http")?a.imageUrl:`${p}${(y=a.imageUrl)!=null&&y.startsWith("/")?a.imageUrl:`/${a.imageUrl}`}`,$=(S=(U=a.category)==null?void 0:U.name)==null?void 0:S.toLowerCase().includes("book");return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(I,{children:[e.jsxs("title",{children:[a.name," | E-Commerce Store"]}),e.jsx("meta",{name:"description",content:a.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("img",{src:N,alt:a.name,loading:"lazy",width:400,height:$?400:300,className:"w-full rounded-lg object-cover",onError:t=>{t.target.onerror=null,t.target.src="https://dummyimage.com/400x300/cccccc/000000&text=No+Image"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:a.description}),e.jsxs("p",{className:"text-xl font-semibold mt-4",children:["PKR ",a.price]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs("span",{className:"text-yellow-500",children:["★".repeat(Math.round(a.avgRating)),"☆".repeat(5-Math.round(a.avgRating))]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",i.length," reviews)"]})]}),e.jsx("button",{onClick:()=>{o(a),j("/cart")},className:"mt-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add to Cart"})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Customer Reviews"}),i.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviews yet."}):i.map(t=>{var r;return e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("strong",{children:((r=t.user)==null?void 0:r.name)||"User"}),e.jsxs("span",{className:"text-yellow-500",children:["★".repeat(t.rating),"☆".repeat(5-t.rating)]})]}),e.jsx("p",{className:"text-gray-800",children:t.comment}),t.imageUrl&&e.jsx("img",{src:t.imageUrl.startsWith("http")?t.imageUrl:`${p}${t.imageUrl.startsWith("/")?t.imageUrl:`/${t.imageUrl}`}`,alt:"review",loading:"lazy",className:"mt-2 w-32 rounded-md object-cover",onError:n=>{n.target.onerror=null,n.target.src="https://dummyimage.com/100x100/cccccc/000000&text=No+Image"}}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(t.createdAt).toLocaleDateString()})]},t._id)}),e.jsx(k,{productId:a._id,onReviewAdded:s})]})]})};export{D as default};
