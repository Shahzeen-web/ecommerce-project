var ye=e=>{throw TypeError(e)};var se=(e,t,s)=>t.has(e)||ye("Cannot "+s);var r=(e,t,s)=>(se(e,t,"read from private field"),s?s.call(e):t.get(e)),x=(e,t,s)=>t.has(e)?ye("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),g=(e,t,s,i)=>(se(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),v=(e,t,s)=>(se(e,t,"access private method"),s);import{S as Fe,p as ve,r as T,s as ie,a as Z,n as ae,i as ne,b as xe,t as Ue,f as Le,c as Qe,d as Re,e as Ie,g as C,h as ke,u as De,j as ge,k as d,L as Ae,l as Me,m as te,o as Te,q as _e}from"./index-2_jk3_Hb.js";var w,h,X,j,k,$,F,U,J,H,W,D,A,L,z,f,K,oe,ce,le,he,ue,de,fe,Ne,Ee,Be=(Ee=class extends Fe{constructor(t,s){super();x(this,f);x(this,w);x(this,h);x(this,X);x(this,j);x(this,k);x(this,$);x(this,F);x(this,U);x(this,J);x(this,H);x(this,W);x(this,D);x(this,A);x(this,L);x(this,z,new Set);this.options=s,g(this,w,t),g(this,U,null),g(this,F,ve()),this.options.experimental_prefetchInRender||r(this,F).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,h).addObserver(this),Se(r(this,h),this.options)?v(this,f,K).call(this):this.updateResult(),v(this,f,he).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return pe(r(this,h),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return pe(r(this,h),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,v(this,f,ue).call(this),v(this,f,de).call(this),r(this,h).removeObserver(this)}setOptions(t){const s=this.options,i=r(this,h);if(this.options=r(this,w).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof T(this.options.enabled,r(this,h))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");v(this,f,fe).call(this),r(this,h).setOptions(this.options),s._defaulted&&!ie(this.options,s)&&r(this,w).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,h),observer:this});const o=this.hasListeners();o&&je(r(this,h),i,this.options,s)&&v(this,f,K).call(this),this.updateResult(),o&&(r(this,h)!==i||T(this.options.enabled,r(this,h))!==T(s.enabled,r(this,h))||Z(this.options.staleTime,r(this,h))!==Z(s.staleTime,r(this,h)))&&v(this,f,oe).call(this);const c=v(this,f,ce).call(this);o&&(r(this,h)!==i||T(this.options.enabled,r(this,h))!==T(s.enabled,r(this,h))||c!==r(this,L))&&v(this,f,le).call(this,c)}getOptimisticResult(t){const s=r(this,w).getQueryCache().build(r(this,w),t),i=this.createResult(s,t);return He(this,i)&&(g(this,j,i),g(this,$,this.options),g(this,k,r(this,h).state)),i}getCurrentResult(){return r(this,j)}trackResult(t,s){return new Proxy(t,{get:(i,o)=>(this.trackProp(o),s==null||s(o),Reflect.get(i,o))})}trackProp(t){r(this,z).add(t)}getCurrentQuery(){return r(this,h)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=r(this,w).defaultQueryOptions(t),i=r(this,w).getQueryCache().build(r(this,w),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return v(this,f,K).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,j)))}createResult(t,s){var G;const i=r(this,h),o=this.options,c=r(this,j),l=r(this,k),m=r(this,$),y=t!==i?t.state:r(this,X),{state:O}=t;let a={...O},n=!1,p;if(s._optimisticResults){const I=this.hasListeners(),Y=!I&&Se(t,s),B=I&&je(t,i,s,o);(Y||B)&&(a={...a,...Qe(O.data,t.options)}),s._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:E,errorUpdatedAt:Q,status:R}=a;p=a.data;let N=!1;if(s.placeholderData!==void 0&&p===void 0&&R==="pending"){let I;c!=null&&c.isPlaceholderData&&s.placeholderData===(m==null?void 0:m.placeholderData)?(I=c.data,N=!0):I=typeof s.placeholderData=="function"?s.placeholderData((G=r(this,W))==null?void 0:G.state.data,r(this,W)):s.placeholderData,I!==void 0&&(R="success",p=Re(c==null?void 0:c.data,I,s),n=!0)}if(s.select&&p!==void 0&&!N)if(c&&p===(l==null?void 0:l.data)&&s.select===r(this,J))p=r(this,H);else try{g(this,J,s.select),p=s.select(p),p=Re(c==null?void 0:c.data,p,s),g(this,H,p),g(this,U,null)}catch(I){g(this,U,I)}r(this,U)&&(E=r(this,U),p=r(this,H),Q=Date.now(),R="error");const M=a.fetchStatus==="fetching",V=R==="pending",q=R==="error",_=V&&M,b=p!==void 0,S={status:R,fetchStatus:a.fetchStatus,isPending:V,isSuccess:R==="success",isError:q,isInitialLoading:_,isLoading:_,data:p,dataUpdatedAt:a.dataUpdatedAt,error:E,errorUpdatedAt:Q,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>y.dataUpdateCount||a.errorUpdateCount>y.errorUpdateCount,isFetching:M,isRefetching:M&&!V,isLoadingError:q&&!b,isPaused:a.fetchStatus==="paused",isPlaceholderData:n,isRefetchError:q&&b,isStale:be(t,s),refetch:this.refetch,promise:r(this,F),isEnabled:T(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const I=ee=>{S.status==="error"?ee.reject(S.error):S.data!==void 0&&ee.resolve(S.data)},Y=()=>{const ee=g(this,F,S.promise=ve());I(ee)},B=r(this,F);switch(B.status){case"pending":t.queryHash===i.queryHash&&I(B);break;case"fulfilled":(S.status==="error"||S.data!==B.value)&&Y();break;case"rejected":(S.status!=="error"||S.error!==B.reason)&&Y();break}}return S}updateResult(){const t=r(this,j),s=this.createResult(r(this,h),this.options);if(g(this,k,r(this,h).state),g(this,$,this.options),r(this,k).data!==void 0&&g(this,W,r(this,h)),ie(s,t))return;g(this,j,s);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,c=typeof o=="function"?o():o;if(c==="all"||!c&&!r(this,z).size)return!0;const l=new Set(c??r(this,z));return this.options.throwOnError&&l.add("error"),Object.keys(r(this,j)).some(m=>{const u=m;return r(this,j)[u]!==t[u]&&l.has(u)})};v(this,f,Ne).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&v(this,f,he).call(this)}},w=new WeakMap,h=new WeakMap,X=new WeakMap,j=new WeakMap,k=new WeakMap,$=new WeakMap,F=new WeakMap,U=new WeakMap,J=new WeakMap,H=new WeakMap,W=new WeakMap,D=new WeakMap,A=new WeakMap,L=new WeakMap,z=new WeakMap,f=new WeakSet,K=function(t){v(this,f,fe).call(this);let s=r(this,h).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(ae)),s},oe=function(){v(this,f,ue).call(this);const t=Z(this.options.staleTime,r(this,h));if(ne||r(this,j).isStale||!xe(t))return;const i=Ue(r(this,j).dataUpdatedAt,t)+1;g(this,D,setTimeout(()=>{r(this,j).isStale||this.updateResult()},i))},ce=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,h)):this.options.refetchInterval)??!1},le=function(t){v(this,f,de).call(this),g(this,L,t),!(ne||T(this.options.enabled,r(this,h))===!1||!xe(r(this,L))||r(this,L)===0)&&g(this,A,setInterval(()=>{(this.options.refetchIntervalInBackground||Le.isFocused())&&v(this,f,K).call(this)},r(this,L)))},he=function(){v(this,f,oe).call(this),v(this,f,le).call(this,v(this,f,ce).call(this))},ue=function(){r(this,D)&&(clearTimeout(r(this,D)),g(this,D,void 0))},de=function(){r(this,A)&&(clearInterval(r(this,A)),g(this,A,void 0))},fe=function(){const t=r(this,w).getQueryCache().build(r(this,w),this.options);if(t===r(this,h))return;const s=r(this,h);g(this,h,t),g(this,X,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Ne=function(t){Ie.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(r(this,j))}),r(this,w).getQueryCache().notify({query:r(this,h),type:"observerResultsUpdated"})})},Ee);function $e(e,t){return T(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Se(e,t){return $e(e,t)||e.state.data!==void 0&&pe(e,t,t.refetchOnMount)}function pe(e,t,s){if(T(t.enabled,e)!==!1&&Z(t.staleTime,e)!=="static"){const i=typeof s=="function"?s(e):s;return i==="always"||i!==!1&&be(e,t)}return!1}function je(e,t,s,i){return(e!==t||T(i.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&be(e,s)}function be(e,t){return T(t.enabled,e)!==!1&&e.isStaleByTime(Z(t.staleTime,e))}function He(e,t){return!ie(e.getCurrentResult(),t)}var Pe=C.createContext(!1),We=()=>C.useContext(Pe);Pe.Provider;function ze(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Ve=C.createContext(ze()),qe=()=>C.useContext(Ve),Ge=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ke=e=>{C.useEffect(()=>{e.clearReset()},[e])},Ze=({result:e,errorResetBoundary:t,throwOnError:s,query:i,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(o&&e.data===void 0||ke(s,[e.error,i])),Xe=e=>{if(e.suspense){const t=i=>i==="static"?i:Math.max(i??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...i)=>t(s(...i)):t(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Je=(e,t)=>e.isLoading&&e.isFetching&&!t,Ye=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Ce=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function et(e,t,s){var a,n,p,E,Q;const i=We(),o=qe(),c=De(),l=c.defaultQueryOptions(e);(n=(a=c.getDefaultOptions().queries)==null?void 0:a._experimental_beforeQuery)==null||n.call(a,l),l._optimisticResults=i?"isRestoring":"optimistic",Xe(l),Ge(l,o),Ke(o);const m=!c.getQueryCache().get(l.queryHash),[u]=C.useState(()=>new t(c,l)),y=u.getOptimisticResult(l),O=!i&&e.subscribed!==!1;if(C.useSyncExternalStore(C.useCallback(R=>{const N=O?u.subscribe(Ie.batchCalls(R)):ae;return u.updateResult(),N},[u,O]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),C.useEffect(()=>{u.setOptions(l)},[l,u]),Ye(l,y))throw Ce(l,u,o);if(Ze({result:y,errorResetBoundary:o,throwOnError:l.throwOnError,query:c.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw y.error;if((E=(p=c.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||E.call(p,l,y),l.experimental_prefetchInRender&&!ne&&Je(y,i)){const R=m?Ce(l,u,o):(Q=c.getQueryCache().get(l.queryHash))==null?void 0:Q.promise;R==null||R.catch(ae).finally(()=>{u.updateResult()})}return l.notifyOnChangeProps?y:u.trackResult(y)}function tt(e,t){return et(e,Be)}const st=async({search:e,category:t,sort:s,page:i})=>{const o=new URLSearchParams;e&&o.append("search",e),t&&o.append("category",t),s&&o.append("sort",s),i&&o.append("page",i);const{data:c}=await ge.get(`http://localhost:5000/api/products?${o.toString()}`);return c};function rt({product:e}){var s,i;const t=(s=e.imageUrl)!=null&&s.startsWith("http")?e.imageUrl:`http://localhost:5000${(i=e.imageUrl)!=null&&i.startsWith("/")?e.imageUrl:`/images/${e.imageUrl}`}`;return d.jsxs(Ae,{to:`/product/${e.id}`,className:"block border rounded-lg shadow-sm hover:shadow-md transition duration-200",children:[d.jsx("div",{className:"w-full h-48 flex items-center justify-center overflow-hidden rounded-t-lg bg-white",children:d.jsx("img",{src:t,alt:e.name,className:"max-h-full object-contain",loading:"lazy",onError:o=>{o.target.onerror=null,o.target.src="http://localhost:5000/images/placeholder.webp"}})}),d.jsxs("div",{className:"p-4",children:[d.jsx("h3",{className:"text-lg font-semibold truncate",children:e.name}),d.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:e.description}),d.jsxs("p",{className:"text-blue-600 font-bold mt-2",children:["Rs ",e.price]})]})]})}var it="Expected a function",we=NaN,at="[object Symbol]",nt=/^\s+|\s+$/g,ot=/^[-+]0x[0-9a-f]+$/i,ct=/^0b[01]+$/i,lt=/^0o[0-7]+$/i,ht=parseInt,ut=typeof te=="object"&&te&&te.Object===Object&&te,dt=typeof self=="object"&&self&&self.Object===Object&&self,ft=ut||dt||Function("return this")(),pt=Object.prototype,mt=pt.toString,gt=Math.max,bt=Math.min,re=function(){return ft.Date.now()};function yt(e,t,s){var i,o,c,l,m,u,y=0,O=!1,a=!1,n=!0;if(typeof e!="function")throw new TypeError(it);t=Oe(t)||0,me(s)&&(O=!!s.leading,a="maxWait"in s,c=a?gt(Oe(s.maxWait)||0,t):c,n="trailing"in s?!!s.trailing:n);function p(b){var P=i,S=o;return i=o=void 0,y=b,l=e.apply(S,P),l}function E(b){return y=b,m=setTimeout(N,t),O?p(b):l}function Q(b){var P=b-u,S=b-y,G=t-P;return a?bt(G,c-S):G}function R(b){var P=b-u,S=b-y;return u===void 0||P>=t||P<0||a&&S>=c}function N(){var b=re();if(R(b))return M(b);m=setTimeout(N,Q(b))}function M(b){return m=void 0,n&&i?p(b):(i=o=void 0,l)}function V(){m!==void 0&&clearTimeout(m),y=0,i=u=o=m=void 0}function q(){return m===void 0?l:M(re())}function _(){var b=re(),P=R(b);if(i=arguments,o=this,u=b,P){if(m===void 0)return E(u);if(a)return m=setTimeout(N,t),p(u)}return m===void 0&&(m=setTimeout(N,t)),l}return _.cancel=V,_.flush=q,_}function me(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function vt(e){return!!e&&typeof e=="object"}function xt(e){return typeof e=="symbol"||vt(e)&&mt.call(e)==at}function Oe(e){if(typeof e=="number")return e;if(xt(e))return we;if(me(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=me(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(nt,"");var s=ct.test(e);return s||lt.test(e)?ht(e.slice(2),s?2:8):ot.test(e)?we:+e}var Rt=yt;const St=Me(Rt),jt=()=>{const[e,t]=C.useState(""),[s,i]=C.useState([]),[o,c]=Te(),l=_e();o.get("search");const m=async a=>{try{const n=await ge.get(`http://localhost:5000/api/products/autocomplete?query=${a}`);i(Array.isArray(n.data)?n.data:[])}catch(n){console.error("Failed to fetch suggestions:",n),i([])}},u=C.useCallback(St(m,300),[]);C.useEffect(()=>{e.trim()?u(e):i([])},[e]);const y=a=>{a.preventDefault();const n=new URLSearchParams(o);e.trim()?n.set("search",e):n.delete("search"),n.set("page","1"),c(n),i([])},O=a=>{l(`/product/${a.id}`),i([]),t("")};return d.jsxs("form",{onSubmit:y,className:"relative max-w-md w-full",children:[d.jsx("input",{type:"text",placeholder:"Search products...",value:e,onChange:a=>t(a.target.value),className:"w-full border px-4 py-2 rounded focus:outline-none"}),Array.isArray(s)&&s.length>0&&d.jsx("ul",{className:"absolute bg-white border border-gray-200 mt-1 rounded w-full shadow-md z-50",children:s.map(a=>d.jsx("li",{onClick:()=>O(a),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:a.name},a.id))})]})};function Ot(){const[e,t]=Te(),[s,i]=C.useState([]),o=e.get("search")||"",c=e.get("category")||"",l=e.get("sort")||"",m=Number(e.get("page")||1),{data:u,isLoading:y,error:O}=tt({queryKey:["products",{search:o,category:c,sort:l,page:m}],queryFn:()=>st({search:o,category:c,sort:l,page:m})});C.useEffect(()=>{ge.get("http://localhost:5000/api/categories").then(n=>i(n.data)).catch(n=>console.error("Error loading categories",n))},[]);const a=(n,p)=>{const E=new URLSearchParams(e);p?E.set(n,p):E.delete(n),E.set("page","1"),t(E)};return y?d.jsx("div",{className:"p-6",children:"Loading..."}):O||!u?d.jsx("div",{className:"p-6 text-red-600",children:"Failed to load products."}):d.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"All Products"}),d.jsx(jt,{}),d.jsxs("div",{className:"flex flex-wrap gap-4 mt-4 mb-6",children:[d.jsxs("select",{value:c,onChange:n=>a("category",n.target.value),className:"border px-2 py-1 rounded",children:[d.jsx("option",{value:"",children:"All Categories"}),s.map(n=>d.jsx("option",{value:n.id,children:n.name},n.id))]}),d.jsxs("select",{value:l,onChange:n=>a("sort",n.target.value),className:"border px-2 py-1 rounded",children:[d.jsx("option",{value:"",children:"Sort By"}),d.jsx("option",{value:"price-asc",children:"Price Low to High"}),d.jsx("option",{value:"price-desc",children:"Price High to Low"}),d.jsx("option",{value:"name-asc",children:"Name A-Z"}),d.jsx("option",{value:"name-desc",children:"Name Z-A"})]})]}),d.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:u.products.length>0?u.products.map(n=>d.jsx(rt,{product:n},n.id)):d.jsx("div",{className:"col-span-full text-gray-500",children:"No products found."})}),d.jsx("div",{className:"flex justify-center mt-6 gap-2",children:Array.from({length:u.totalPages},(n,p)=>p+1).map(n=>d.jsx("button",{onClick:()=>a("page",n),className:`px-3 py-1 border rounded ${n===m?"bg-blue-600 text-white":"bg-white"}`,children:n},n))})]})}export{Ot as default};
