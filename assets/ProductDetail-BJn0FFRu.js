import{v as U,g as r,j as e,q as N,o as E,w as I,H as k}from"./index-CQxHUdJB.js";const P=({user:u})=>{const{id:f}=U(),[i,t]=r.useState(0),[d,l]=r.useState(""),[x,p]=r.useState(null),[h,o]=r.useState(""),v=async a=>{if(a.preventDefault(),!i||!d){o("Rating and comment are required.");return}try{let n=null;if(x){const m=new FormData;m.append("image",x),n=(await N.post("/api/upload",m,{headers:{"Content-Type":"multipart/form-data"}})).data.url}await N.post("/api/reviews",{rating:i,comment:d,imageUrl:n,productId:parseInt(f)},{withCredentials:!0}),o("Review submitted! Awaiting approval."),t(0),l(""),p(null)}catch(n){console.error("Review submit error:",n),o("Error submitting review.")}};return e.jsxs("form",{onSubmit:v,className:"mt-8 border p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Write a Review"}),h&&e.jsx("p",{className:"mb-2 text-sm text-blue-500",children:h}),e.jsx("label",{className:"block mb-2 font-semibold",children:"Rating"}),e.jsx("div",{className:"flex gap-1 mb-4",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>t(a),className:`text-2xl ${i>=a?"text-yellow-500":"text-gray-300"}`,children:"★"},a))}),e.jsx("label",{className:"block mb-2 font-semibold",children:"Comment"}),e.jsx("textarea",{value:d,onChange:a=>l(a.target.value),className:"w-full border rounded p-2 mb-4",rows:4,required:!0}),e.jsx("label",{className:"block mb-2 font-semibold",children:"Upload Image (optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>p(a.target.files[0]),className:"mb-4"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Submit Review"})]})},j=void 0,L=()=>{var m,w,y,R;const{id:u}=U(),f=E(),i=I(s=>s.addToCart),[t,d]=r.useState(null),[l,x]=r.useState([]),[p,h]=r.useState(!0),[o,v]=r.useState("");if(r.useEffect(()=>{(async()=>{try{const c=await N.get(`${j}/api/products/${u}`),g=await N.get(`${j}/api/reviews/${u}`),b=Array.isArray(g.data)?g.data:[],C=b.reduce(($,A)=>$+A.rating,0),S=b.length?C/b.length:0;d({...c.data,avgRating:S}),x(b)}catch(c){console.error("Error fetching product or reviews:",c),v("Failed to load product details.")}finally{h(!1)}})()},[u]),p)return e.jsx("div",{className:"p-8",children:"Loading..."});if(o)return e.jsx("div",{className:"p-8 text-red-600",children:o});if(!t)return e.jsx("div",{className:"p-8",children:"Product not found"});const a=(m=t.imageUrl)!=null&&m.startsWith("http")?t.imageUrl:`${j}${(w=t.imageUrl)!=null&&w.startsWith("/")?t.imageUrl:`/${t.imageUrl}`}`,n=(R=(y=t.category)==null?void 0:y.name)==null?void 0:R.toLowerCase().includes("book");return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(k,{children:[e.jsxs("title",{children:[t.name," | ecommerce-store"]}),e.jsx("meta",{name:"description",content:t.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("img",{src:a,alt:t.name,loading:"lazy",width:400,height:n?400:300,className:"w-full rounded-lg object-cover",onError:s=>{s.target.onerror=null,s.target.src="https://dummyimage.com/400x300/cccccc/000000&text=No+Image"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsx("p",{className:"text-gray-600 mt-2",children:t.description}),e.jsxs("p",{className:"text-xl font-semibold mt-4",children:["Rs. ",t.price]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs("span",{className:"text-yellow-500 text-lg",children:["★".repeat(Math.round(t.avgRating)),"☆".repeat(5-Math.round(t.avgRating))]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",l.length," reviews)"]})]}),e.jsx("button",{onClick:()=>{i(t),f("/cart")},className:"mt-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add to Cart"})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Customer Reviews"}),l.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviews yet."}):l.map(s=>{var c;return e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("strong",{children:((c=s.user)==null?void 0:c.name)||"User"}),e.jsxs("span",{className:"text-yellow-500",children:["★".repeat(s.rating),"☆".repeat(5-s.rating)]})]}),e.jsx("p",{className:"text-gray-800",children:s.comment}),s.imageUrl&&e.jsx("img",{src:s.imageUrl.startsWith("http")?s.imageUrl:`${j}${s.imageUrl.startsWith("/")?s.imageUrl:`/${s.imageUrl}`}`,alt:"review",loading:"lazy",className:"mt-2 w-32 rounded-md object-cover",onError:g=>{g.target.onerror=null,g.target.src="https://dummyimage.com/100x100/cccccc/000000&text=No+Image"}}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(s.createdAt).toLocaleDateString()})]},s.id)}),e.jsx(P,{})]})]})};export{L as default};
