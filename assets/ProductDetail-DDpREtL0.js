import{g as o,j as e,v as L,o as M,w as D,H as W,q as P}from"./index-BbEjm1PE.js";const k=({productId:v,onReviewSubmit:f})=>{const[i,a]=o.useState(0),[d,m]=o.useState(""),[x,w]=o.useState(null),[h,b]=o.useState(null);o.useEffect(()=>{if(x){const t=URL.createObjectURL(x);return b(t),()=>URL.revokeObjectURL(t)}else b(null)},[x]);const j=t=>{w(t.target.files[0])},y=t=>{if(t.preventDefault(),!i||!d.trim()){alert("Please provide a rating and a comment.");return}const R={productId:v,rating:i,comment:d,image:h,createdAt:new Date().toISOString()};f(R),a(0),m(""),w(null)};return e.jsxs("form",{onSubmit:y,className:"border p-4 rounded-lg shadow-md mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Write a Review"}),e.jsx("div",{className:"flex gap-1 mb-3",children:[1,2,3,4,5].map(t=>e.jsx("span",{className:`cursor-pointer text-2xl ${t<=i?"text-yellow-500":"text-gray-400"}`,onClick:()=>a(t),role:"button","aria-label":`Rate ${t} star`,children:"★"},t))}),e.jsx("label",{className:"block mb-1 font-medium",children:"Your Comment:"}),e.jsx("textarea",{value:d,onChange:t=>m(t.target.value),className:"w-full border rounded p-2 mb-3",rows:"3",placeholder:"Write your review..."}),e.jsx("label",{className:"block mb-1 font-medium",children:"Upload an Image:"}),e.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"mb-3"}),h&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:h,alt:"Preview",className:"w-24 h-24 object-cover rounded"})}),e.jsx("button",{type:"submit",disabled:!i||!d.trim(),className:`px-4 py-2 rounded text-white ${!i||!d.trim()?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:"Submit Review"})]})},N="https://ecommerce-project-production-28e7.up.railway.app",O=()=>{const{id:v}=L(),f=M(),i=D(r=>r.addToCart),[a,d]=o.useState(null),[m,x]=o.useState([]),[w,h]=o.useState(!0),[b,j]=o.useState("");o.useEffect(()=>{let r=!1;const s=async()=>{var u,p;h(!0),j("");try{const n=await P.get(`${N}/api/products/${v}`),c=((u=n.data)==null?void 0:u.product)??n.data??null;if(!c){r||j("Product not found.");return}const l=await P.get(`${N}/api/reviews/${v}`),g=Array.isArray(l.data)?l.data:((p=l.data)==null?void 0:p.reviews)||[],U=g.reduce((E,S)=>E+Number((S==null?void 0:S.rating)||0),0),A=g.length?U/g.length:0,I=Math.max(0,Math.min(5,A));r||(d({...c,avgRating:I}),x(g))}catch(n){console.error("❌ Product detail fetch failed:",n),r||j("Failed to load product details.")}finally{r||h(!1)}};return window.scrollTo(0,0),s(),()=>{r=!0}},[v]);const y=r=>{const s=[r,...m];x(s);const u=s.reduce((c,l)=>c+Number((l==null?void 0:l.rating)||0),0),p=s.length?u/s.length:0,n=Math.max(0,Math.min(5,p));d(c=>c&&{...c,avgRating:n})};if(w)return e.jsx("div",{className:"p-8",children:"Loading..."});if(b)return e.jsx("div",{className:"p-8 text-red-600",children:b});if(!a)return e.jsx("div",{className:"p-8",children:"Product not found"});const t=a.imageUrl||a.image||"",R=t.startsWith("http")?t:`${N}${t.startsWith("/")?t:`/${t}`}`,C=Math.round(a.avgRating||0),$="★".repeat(C)+"☆".repeat(5-C);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs(W,{children:[e.jsxs("title",{children:[a.name," | E-Commerce Store"]}),e.jsx("meta",{name:"description",content:a.description||""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("img",{src:R,alt:a.name||"Product",loading:"lazy",width:400,height:300,className:"w-full rounded-lg object-cover bg-gray-50",onError:r=>{r.currentTarget.onerror=null,r.currentTarget.src="https://dummyimage.com/400x300/cccccc/000000&text=No+Image"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.name||"Product"}),e.jsx("p",{className:"text-gray-600 mt-2",children:a.description||"No description."}),e.jsxs("p",{className:"text-xl font-semibold mt-4",children:["PKR ",a.price??"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("span",{className:"text-yellow-500",children:$}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",m.length," reviews)"]})]}),e.jsx("button",{onClick:()=>{i==null||i(a),f("/cart")},className:"mt-6 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Add to Cart"})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Customer Reviews"}),m.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviews yet."}):m.map(r=>{var l;const s=r||{},u=Math.max(0,Math.min(5,Number(s.rating||0))),p="★".repeat(u)+"☆".repeat(5-u),n=s.imageUrl||"",c=n?n.startsWith("http")?n:`${N}${n.startsWith("/")?n:`/${n}`}`:"";return e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("strong",{children:((l=s.user)==null?void 0:l.name)||"User"}),e.jsx("span",{className:"text-yellow-500",children:p})]}),e.jsx("p",{className:"text-gray-800",children:s.comment||""}),c&&e.jsx("img",{src:c,alt:"review",loading:"lazy",className:"mt-2 w-32 rounded-md object-cover bg-gray-50",onError:g=>{g.currentTarget.onerror=null,g.currentTarget.src="https://dummyimage.com/100x100/cccccc/000000&text=No+Image"}}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():""})]},s._id||s.id)}),e.jsx(k,{productId:a._id||a.id,onReviewAdded:y})]})]})};export{O as default};
